require 'rubygems'
require 'less'

module Less
  def self.register_helper(name, &block)
    tree = @loader.require('less/tree')
    tree.functions[name] = lambda do |node|
      tree[:Anonymous].new block.call(tree, node)
    end
  end
end

#Less.register_helper('bootstrap_theme_choose') do |tree, cxt|
#  "http://app.com/assets/#{cxt.toCSS()}.png"
#end
Less.register_helper('asset-url') do |tree, cxt|
  "http://app.com/assets/#{cxt.toCSS()}.png"
end

parser = Less::Parser.new
puts parser.parse('@background: pic; body {width: 10px; background-image: bootstrap_theme_choose(@background);}').to_css
